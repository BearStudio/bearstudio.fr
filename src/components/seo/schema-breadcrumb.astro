---
import { Schema } from 'astro-seo-schema';

import { isNonNullish } from 'remeda';

import { getLink } from '@/lib/link';
import { getTranslationFn, parseAstroLocale } from '@/i18n/utils';

interface Props {
  items: Array<{ id: string; name: string } | undefined>;
}

const { items } = Astro.props;

const locale = parseAstroLocale(Astro.currentLocale);
const t = getTranslationFn(locale);
---

<Schema
  slot="breadcrumb"
  item={{
    '@context': 'https://schema.org',
    '@type': 'BreadcrumbList',
    itemListElement: [
      {
        '@type': 'ListItem',
        position: 1,
        item: {
          '@id': getLink('/fr', locale, {}, true),
          name: t('common.nav.home'),
        },
      },
      ...items.filter(isNonNullish).map((item, index) => ({
        '@type': 'ListItem' as const,
        position: index + 2,
        item: {
          '@id': item.id,
          name: item.name,
        },
      })),
    ],
  }}
/>
