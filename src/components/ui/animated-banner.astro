---
import { Image } from 'astro:assets';
import type { ComponentProps } from 'astro/types';

import type { ImageMetadata } from 'astro';

import { getValueFromText } from '@/lib/get-value-from-text';
import CurvedLoop from '@/components/ui/curved-loop';

interface Props {
  image: ImageMetadata;
  imageProps?: ComponentProps<typeof Image>;
  text: string;
  curvedLoopProps?: ComponentProps<typeof CurvedLoop>;
}

const props = Astro.props;

// if you want to customize the boundaries of the curve value or position,
// change the min and max
const curveAmount = getValueFromText(props.text, { min: -200, max: 300 });
const position = getValueFromText(props.text, { min: -5, max: 5 });
const speed = getValueFromText(props.text, { min: 0.4, max: 1.3 });
---

<div
  class="bg-brand-800 relative aspect-video w-full overflow-hidden rounded-lg"
>
  <!-- Background (translate3d is for safari to apply mix-blend-overlay) -->
  <Image
    class="absolute inset-0 object-cover opacity-30 mix-blend-overlay grayscale"
    src={props.image}
    alt=""
    style={{ transform: 'translate3d(0, 0, 0)' }}
    {...props.imageProps}
  />
  <div
    class={`absolute  right-0 bottom-0 left-0 flex items-center justify-center`}
    style={{
      top: `${position}rem`,
    }}
  >
    <CurvedLoop
      client:visible
      marqueeText={`${props.text} âœ¦ `}
      speed={speed}
      curveAmount={curveAmount}
      className="absolute inset-0 fill-white"
      interactive={false}
      {...props.curvedLoopProps}
    />
  </div>
</div>
