---
import { Image } from 'astro:assets';

import type { ImageMetadata } from 'astro';

import { getLink } from '@/lib/link';
import { cn } from '@/lib/tailwind/utils';
import { LanguageSwitcher } from '@/components/nav/language-switcher';
import { NavPrimaryButton } from '@/components/nav/nav-primary-button';
import { Logo } from '@/components/ui/logo';
import { ScratchFull } from '@/components/ui/scratch';
import { parseAstroLocale } from '@/i18n/utils';

import defaultBg from './hero-bg.jpeg';

interface Props {
  contentClassName?: string;
  image?: ImageMetadata | undefined;
}
const { image, contentClassName } = Astro.props;
const locale = parseAstroLocale(Astro.currentLocale);
---

<div
  class="bg-hero text-hero-foreground pt-safe-top relative z-0 flex flex-col overflow-hidden"
>
  <!-- Mobile Top Actions -->
  <div
    class="relative z-10 mx-auto flex w-full max-w-5xl justify-between p-4 lg:hidden"
  >
    <LanguageSwitcher
      client:load
      locale={parseAstroLocale(Astro.currentLocale)}
    />
    <NavPrimaryButton locale={parseAstroLocale(Astro.currentLocale)} />
  </div>

  <!-- Content -->
  <div
    class={cn(
      'relative z-10 flex flex-1 flex-col gap-10 pt-8 pb-24 lg:pt-32 lg:pb-34',
      contentClassName
    )}
  >
    <div
      class="mx-auto flex w-full max-w-5xl flex-1 flex-col justify-center gap-12 px-6"
    >
      <a href={getLink('/fr', locale, {})} class="relative z-10 lg:hidden">
        <Logo className="mx-auto w-38 sm:w-52" />
      </a>

      <div class="flex flex-1 flex-col justify-center">
        <slot />
      </div>
    </div>
  </div>

  <!-- Background (translate3d is for safari to apply mix-blend-overlay) -->
  <Image
    src={image ?? defaultBg}
    alt=""
    fetchpriority="high"
    width={1600}
    height={900}
    layout="constrained"
    loading="eager"
    class="absolute inset-0 z-0 h-full w-full object-cover opacity-30 mix-blend-overlay grayscale"
    style={{ transform: 'translate3d(0, 0, 0)' }}
  />
  <div class="from-hero/90 to-hero/0 absolute inset-0 z-0 bg-linear-to-b"></div>

  <ScratchFull className="text-background -mt-8 -mb-px" />
</div>
