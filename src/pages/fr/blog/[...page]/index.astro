---
import type { GetStaticPathsOptions } from 'astro';
import { PiArrowLeftBold, PiArrowRight } from 'react-icons/pi';

import { getPostsCollection } from '@/lib/posts';
import { breadcrumbEntries } from '@/components/breadcrumb/utils';
import HeroContent from '@/components/hero/hero-content.astro';
import Hero from '@/components/hero/hero.astro';
import PostCard from '@/components/posts/post-card.astro';
import SEO from '@/components/seo/index.astro';
import { getAlternates } from '@/components/seo/utils';
import type { Locale } from '@/i18n/utils';
import { getTranslationFn, parseAstroLocale } from '@/i18n/utils';
import MainLayout from '@/layouts/main-layout.astro';

export async function generateStaticPaths(
  params: {
    locale: Locale;
  } & GetStaticPathsOptions
) {
  const PAGE_SIZE = 24;
  const newsPages = await getPostsCollection({
    locale: params.locale,
  });

  return [
    ...params.paginate(newsPages, {
      pageSize: PAGE_SIZE,
    }),
  ];
}

export async function getStaticPaths(params: GetStaticPathsOptions) {
  return generateStaticPaths({ ...params, locale: 'fr' });
}

const locale = parseAstroLocale(Astro.currentLocale);
const t = getTranslationFn(locale);

const { page } = Astro.props;

const breadcrumb = breadcrumbEntries(locale)((entry) => [
  entry({
    path: '/fr/blog',
    params: {},
    label: t('blog.root.breadcrumb'),
  }),
  page.currentPage > 1
    ? entry({
        path: '/fr/blog/:page',
        params: { page: page.currentPage.toString() },
        label: `Page ${page.currentPage}`,
      })
    : undefined,
]);
---

<MainLayout>
  <SEO
    slot="seo"
    title={t('blog.root.metadata.title')}
    description={t('blog.root.metadata.description')}
    alternates={getAlternates('/fr/blog/:page', {
      page: page.currentPage.toString(),
    })}
    breadcrumb={breadcrumb}
  />
  <Hero>
    <HeroContent
      breadcrumb={breadcrumb}
      title={t('blog.root.title')}
      description={t('blog.root.description')}
    />
  </Hero>
  <div class="-mt-16 lg:-mt-24">
    <div class="mx-auto w-full max-w-5xl px-6">
      <div class="xs:grid-cols-2 relative grid gap-4 py-4 md:grid-cols-3">
        {page.data.map((post) => <PostCard post={post} />)}
      </div>
      <div class="flex justify-between pt-4">
        {
          !!page.url.prev && (
            <a href={page.url.prev}>
              Newer <span class="max-xs:sr-only">articles</span>
              <PiArrowLeftBold className="size-4" />
            </a>
          )
        }
        {
          !!page.url.next && (
            <a href={page.url.next}>
              <PiArrowRight className="size-4" />
              Older <span class="max-xs:sr-only">articles</span>
            </a>
          )
        }
      </div>
    </div>
  </div>
</MainLayout>
