---
import type { GetStaticPathsOptions } from 'astro';

import { getPostsCollection } from '@/lib/posts';
import Pagination from '@/components/blog/pagination.astro';
import PostCard from '@/components/blog/post-card.astro';
import PostsGrid from '@/components/blog/posts-grid.astro';
import { breadcrumbEntries } from '@/components/breadcrumb/utils';
import Container from '@/components/container.astro';
import HeroContent from '@/components/hero/hero-content.astro';
import Hero from '@/components/hero/hero.astro';
import SEO from '@/components/seo/index.astro';
import { getAlternates } from '@/components/seo/utils';
import type { Locale } from '@/i18n/utils';
import { getTranslationFn, parseAstroLocale } from '@/i18n/utils';
import MainLayout from '@/layouts/main-layout.astro';

export async function generateStaticPaths(
  params: {
    locale: Locale;
  } & GetStaticPathsOptions
) {
  const PAGE_SIZE = 24;
  const allPosts = await getPostsCollection({
    locale: params.locale,
  });

  return params.paginate(allPosts, {
    pageSize: PAGE_SIZE,
  });
}

export async function getStaticPaths(params: GetStaticPathsOptions) {
  return generateStaticPaths({ ...params, locale: 'fr' });
}

const locale = parseAstroLocale(Astro.currentLocale);
const t = getTranslationFn(locale);

const { page } = Astro.props;

const breadcrumb = breadcrumbEntries(locale)((entry) => [
  entry({
    path: '/fr/blog',
    params: {},
    label: t('blog.root.breadcrumb'),
  }),
  page.currentPage > 1
    ? entry({
        path: '/fr/blog/:page',
        params: { page: page.currentPage.toString() },
        label: `Page ${page.currentPage}`,
      })
    : undefined,
]);
---

<MainLayout>
  <SEO
    slot="seo"
    title={t('blog.root.metadata.title')}
    description={t('blog.root.metadata.description')}
    alternates={page.currentPage > 1
      ? getAlternates('/fr/blog/:page', {
          page: page.currentPage.toString(),
        })
      : getAlternates('/fr/blog', {})}
    breadcrumb={breadcrumb}
  />
  <Hero>
    <HeroContent
      breadcrumb={breadcrumb}
      title={t('blog.root.title')}
      description={t('blog.root.description')}
    />
  </Hero>
  <Container placement="overlapHero">
    <PostsGrid>
      {page.data.map((post) => <PostCard post={post} />)}
    </PostsGrid>
    <Pagination
      currentPage={page.currentPage}
      nextUrl={page.url.next}
      prevUrl={page.url.prev}
    />
  </Container>
</MainLayout>
