---
import { getEventsGroupedByYearCollection } from '@/lib/events';
import { getLink } from '@/lib/link';
import { breadcrumbEntries } from '@/components/breadcrumb/utils';
import Container from '@/components/container.astro';
import HeroContent from '@/components/hero/hero-content.astro';
import Hero from '@/components/hero/hero.astro';
import SEO from '@/components/seo/index.astro';
import { getAlternates } from '@/components/seo/utils';
import { getTranslationFn, parseAstroLocale, type Locale } from '@/i18n/utils';
import MainLayout from '@/layouts/main-layout.astro';

export async function generateStaticPaths(params: { locale: Locale }) {
  const eventsByYear = await getEventsGroupedByYearCollection({
    locale: params.locale,
  });

  return Promise.all(
    Object.entries(eventsByYear).map(([year, events]) => {
      return {
        params: { year },
        props: { events },
      };
    })
  );
}

export async function getStaticPaths() {
  return generateStaticPaths({ locale: 'fr' });
}

const locale = parseAstroLocale(Astro.currentLocale);
const t = getTranslationFn(locale);
const { events } = Astro.props;
const { year } = Astro.params;

const breadcrumb = breadcrumbEntries(locale)((entry) => [
  entry({
    label: t('events.root.breadcrumb'),
    path: '/fr/events',
    params: {},
  }),
  entry({
    label: year,
    path: '/fr/events/annee/:year',
    params: {
      year,
    },
  }),
]);
---

<MainLayout>
  <SEO
    slot="seo"
    title={t('blog.root.metadata.title')}
    description={t('blog.root.metadata.description')}
    alternates={getAlternates('/fr/events/annee/:year', { year })}
    breadcrumb={breadcrumb}
  />

  <Hero>
    <HeroContent
      breadcrumb={breadcrumb}
      title={t('team.root.title')}
      description={t('team.root.description')}
    />
  </Hero>

  <Container class="gap-12">
    <ul>
      {
        events.map(async (event) => (
          <li>
            <a
              href={getLink('/fr/events/:id', locale, {
                id: event.data._computed.slug,
              })}
            >
              {event.data.title}
            </a>
          </li>
        ))
      }
    </ul>
  </Container>
</MainLayout>
