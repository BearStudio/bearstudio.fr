---
import { Schema } from 'astro-seo-schema';
import { Image } from 'astro:assets';
import { render } from 'astro:content';
import type { CollectionEntry } from 'astro:content';

import { lunalink } from '@bearstudio/lunalink';

import { getBlogCollectionLinkedToTeamMember } from '@/lib/blog';
import { getTeamCollection } from '@/lib/team';
import Prose from '@/components/prose.astro';
import SEO from '@/components/seo/index.astro';
import MainLayout from '@/layouts/main-layout.astro';
import { ROUTES } from '@/routes.gen';

export async function getStaticPaths() {
  const team = await getTeamCollection({ lang: 'fr' });

  return team.map((person) => ({
    params: { id: person.data._computed.slug },
    props: person,
  }));
}
type Props = CollectionEntry<'team'>;

const person = Astro.props;
const { Content } = await render(person);
const url = new URL(Astro.url.pathname, Astro.site);

const posts = await getBlogCollectionLinkedToTeamMember({ author: person });
---

<MainLayout>
  <!-- [TODO]: SEO -->
  <SEO slot="seo" title={person.data.name} url={url} />
  <Schema
    slot="ld+json"
    item={{
      '@context': 'https://schema.org',
      '@type': 'Person',
      headline: person.data.name,
      isAccessibleForFree: true,
    }}
  />
  <div class="mx-auto flex w-full max-w-screen-sm flex-col gap-4 px-4">
    <div class="flex flex-col items-center gap-2">
      <span>
        {person.data.name}
      </span>
      <span>
        {person.data.job}
      </span>
      {
        person.data.picture && (
          <Image src={person.data.picture} alt={person.data.name} />
        )
      }

      {
        person.data.socials?.map((social) => (
          <a href={social.href}>{social.type}</a>
        ))
      }

      {person.data.status}
      {String(person.data.hidden)}
    </div>
    <Prose>
      <Content />
    </Prose>

    <h2>Articles li√©s</h2>
    {
      posts.map((post) => {
        return (
          <a
            href={lunalink(ROUTES.fr.blog.posts[':id'].__path, {
              id: post.data.computed.slug,
            })}
          >
            {post.data.title}
          </a>
        );
      })
    }
  </div>
</MainLayout>
